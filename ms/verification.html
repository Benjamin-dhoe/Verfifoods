<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Verification</title>
  <meta content="Verify email" property="og:title">
  <meta content="Verify email" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="/css/normalize.css" rel="stylesheet" type="text/css">
  <link href="/css/webflow.css" rel="stylesheet" type="text/css">
  <link href="/css/verfifoods-4d83b7.webflow.css" rel="stylesheet" type="text/css">
  <script src="https://use.typekit.net/nnx8vsx.js" type="text/javascript"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="/images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="/images/webclip.png" rel="apple-touch-icon">
  <link rel="stylesheet" href="https://use.typekit.net/nnx8vsx.css">
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
</head>
<body class="body">
  <div class="logosolo">
    <a href="#" class="w-inline-block" id="loginlink"><img src="/images/logo-Verfifoods.png" loading="lazy" width="135" alt=""></a>
  </div>
  <section class="section-doublepart">
    <div class="containcenter doubleparts">
      <div class="doublepartsside centered">
        <h2 class="headingonwhite" id="title"></h2>
      </div>
      <div class="doublepartsside right centered">
        <div>
          <div class="leftalignflexvert">
            <label for="Email" class="brownundertitle" id="labeltext"></label>
            <input class="text-field w-input" maxlength="256" name="Email" type="email" id="Email" required>
        
            <button class="button intypeholder notabs w-button" id="loginbtn"></button>
            
          </div>
        
          <div class="w-form-fail" id="error-message"></div>
        </div>
      </div>
    </div>
  </section>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=66d843f7aa41c71a1134cb81" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script>
import { getAuth, isSignInWithEmailLink, signInWithEmailLink } from "firebase/auth";
import { initializeApp, getApps, getApp } from "firebase/app";

// Initialize Firebase
const firebaseConfig = {
    apiKey: "AIzaSyCIQlfqz-Hd-Oe0tNjnEfJdwHwMy3JuNr4",
    authDomain: "test-9efbe.firebaseapp.com",
    projectId: "test-9efbe",
    storageBucket: "test-9efbe.appspot.com",
    messagingSenderId: "218327249026",
    appId: "1:218327249026:web:0d48fa588ac45ef557049b",
    measurementId: "G-2ZTZCL27TE"
};

const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
const auth = getAuth(app);

// Helper function to get query parameters
function getQueryParams() {
    const params = new URLSearchParams(window.location.search);
    return {
        lang: params.get('lang'),
        action: params.get('action')
    };
}

// Function to update UI based on language
function updateContent() {
    const queryParams = getQueryParams();
    const titleElement = document.getElementById("title");
    const textElement = document.getElementById("labeltext");
    const loginlink = document.getElementById("loginbtn");

    if (queryParams.lang === 'nl') {
        titleElement.textContent = "Email verificatie";
        textElement.textContent = "Email adres";
        loginlink.textContent = "Doorgaan";
    } else if (queryParams.lang === 'fr') {
        titleElement.textContent = "Verification email";
        textElement.textContent = "Adresse email";
        loginlink.textContent = "Continuer";
    } else {
        titleElement.textContent = "Email verification";
        textElement.textContent = "Email address";
        loginlink.textContent = "Continue";
    }
}

window.onload = updateContent; // Call this function when the page loads

// When the window loads, check for the sign-in link and handle form submit
window.addEventListener('load', () => {
    if (isSignInWithEmailLink(auth, window.location.href)) {
        // Pre-fill email if previously stored
        let email = window.localStorage.getItem('emailForSignIn');
        
        // If no email in localStorage, wait for form submission
        const loginBtn = document.getElementById('loginbtn');
        loginBtn.addEventListener('click', async (event) => {
            event.preventDefault(); // Prevent default form submission

            // Get the email from the input field
            const emailInput = document.getElementById('Email');
            email = emailInput.value;

            if (!email) {
                document.getElementById('error-message').textContent = "Please provide your email for confirmation.";
                return;
            }

            try {
                // Sign in with the email link
                const result = await signInWithEmailLink(auth, email, window.location.href);
                
                // Remove the email from localStorage
                window.localStorage.removeItem('emailForSignIn');

                // Get user ID
                const userId = result.user.uid;

                // Redirect based on 'lang' query parameter
                const queryParams = getQueryParams();
                let langPath = '';

                if (queryParams.lang === 'nl') {
                    langPath = `/nl/user/${userId}`;
                } else if (queryParams.lang === 'en') {
                    langPath = `/en/user/${userId}`;
                } else {
                    langPath = `/user/${userId}`; // Default case
                }

                // Redirect user
                window.location.href = langPath;

            } catch (error) {
                // Handle errors
                document.getElementById('error-message').textContent = "Error signing in: " + error.message;
            }
        });
    }
});


  
</script>
</body>
</html>
