<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Checkout</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="/css/normalize.css" rel="stylesheet" type="text/css">
  <link href="/css/webflow.css" rel="stylesheet" type="text/css">
  <link href="/css/verfifoods-4d83b7.webflow.css" rel="stylesheet" type="text/css">
  <script src="https://use.typekit.net/nnx8vsx.js" type="text/javascript"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="/images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="/images/webclip.png" rel="apple-touch-icon">
  <link rel="stylesheet" href="https://use.typekit.net/nnx8vsx.css">
</head>
<body class="body">
  <div class="logosolo">
    <a href="#" class="w-inline-block" id="loginlink"><img src="/images/logo-Verfifoods.png" loading="lazy" width="135" alt=""></a>
  </div>
  <section class="sectionsingle">
    <div class="containcenter smallcenter">
        <h1 class="headingonwhite">Checkout</h1>
        <div class="spacer10px"></div>
        <div class="spacer10px"></div>
        <form id="checkoutForm">
          <label class="brownundertitle">Comande personelle / entreprise</label>
          <div class="radio-container">
            <label class="radio-label">
              <input type="radio" name="type" value="personal" class="radio-input" required>
              Commande personnelle
            </label>
            <label class="radio-label">
              <input type="radio" name="type" value="business" class="radio-input" required>
              Commande d'entreprise
            </label>
          </div>
          <div class="spacer10px"></div>
          <label class="brownundertitle">Livraison / retrait</label>
          <div class="radio-container">
            <label class="radio-label">
              <input type="radio" name="delivery" value="delivery" class="radio-input" required>
              Livraison (seulement Bruxelles, Brabant Flamand et Brabant Wallon)
            </label>
            <label class="radio-label">
              <input type="radio" name="delivery" value="pickup" class="radio-input" required>
              Retrait (Overijse)
            </label>
          </div>
          <div class="spacer10px"></div>
          <label class="brownundertitle">Email</label>
          <input class="text-field w-input" maxlength="256" type="text" id="email" name="email" required>
          <label class="brownundertitle">Telephone</label>
          <input class="text-field w-input" maxlength="256" type="text" id="telephone" name="telephone" required>
          <div id="personaldiv" style="display: none;">
            <label class="brownundertitle">Prénom</label>
            <input class="text-field w-input" maxlength="256" type="text" id="firstname" name="firstname" required>
            <label class="brownundertitle">Nom</label>
            <input class="text-field w-input" maxlength="256" type="text" id="name" name="name" required>
          </div>
          <div id="businessdiv" style="display: none;">
            <label class="brownundertitle">Nom de l'entreprise</label>
            <input class="text-field w-input" maxlength="256" type="text" id="companyname" name="companyname" required>
            <label class="brownundertitle">Numéro de TVA</label>
            <input class="text-field w-input" maxlength="256" type="text" id="btwnr" name="btwnr" required>
          </div>
            <div class="spacer10px"></div>
            <label class="brownundertitle bold-text">Adresse de facturation</label>
            <label class="brownundertitle">Rue et numéro de maison</label>
            <input class="text-field w-input" maxlength="256" type="text" id="streetnrfact" name="streetnrfact" required>
            <label class="brownundertitle">Code postale</label>
            <input class="text-field w-input" maxlength="256" type="text" id="postcodefact" name="postcodefact" required>
            <label class="brownundertitle">Lieu</label>
            <input class="text-field w-input" maxlength="256" type="text" id="placefact" name="placefact" required>
            <div class="spacer10px"></div>
            <div id="onlydelivery">
              <label class="brownundertitle bold-text">Adresse de livraison</label>
              <label>
                <input type="checkbox" id="samedeliveryadress" name="samedeliveryadress">
                <span></span>
                Identique à l'adresse de facturation
              </label>
              <div class="spacer10px"></div>
            
              <div id="deliveryadress">
                  <label class="brownundertitle">Rue et numéro de maison</label>
                  <input class="text-field w-input" maxlength="256" type="text" id="deliverystreetnr" name="deliverystreetnr" required>
                  <label class="brownundertitle">Code postale</label>
                  <input class="text-field w-input" maxlength="256" type="text" id="deliverypostcode" name="deliverypostcode" required>
                  <label class="brownundertitle">Lieu</label>
                  <input class="text-field w-input" maxlength="256" type="text" id="deliveryplace" name="deliveryplace" required>
                </div>
            </div>
          <div class="spacer10px"></div>
          <div class="loading" id="loading" style="display: none;">
              <lottie-player
                  src="/images/loading.json"
                  background="transparent"
                  speed="1"
                  loop
                  autoplay>
              </lottie-player>
          </div>
          <button type="submit" class="button intypeholder notabs w-button" id="submitform">Doorgaan</button>
        </form>
    </div>
  </section>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=66d843f7aa41c71a1134cb81" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script>
document.addEventListener('DOMContentLoaded', function () {
  const personalDiv = document.getElementById('personaldiv');
  const businessDiv = document.getElementById('businessdiv');
  const personalRadio = document.querySelector('input[value="personal"]');
  const businessRadio = document.querySelector('input[value="business"]');
  const deliveryRadio = document.querySelector('input[value="delivery"]');
  const pickupRadio = document.querySelector('input[value="pickup"]');
  const sameDeliveryCheckbox = document.getElementById('samedeliveryadress');
  const deliveryAddressDiv = document.getElementById('deliveryadress');
  const onlyDeliveryDiv = document.getElementById('onlydelivery');

  const factuurStreet = document.getElementById('streetnrfact');
  const factuurPostcode = document.getElementById('postcodefact');
  const factuurPlace = document.getElementById('placefact');

  const deliveryStreet = document.getElementById('deliverystreetnr');
  const deliveryPostcode = document.getElementById('deliverypostcode');
  const deliveryPlace = document.getElementById('deliveryplace');

  function toggleAccountDivs() {
    if (personalRadio.checked) {
      personalDiv.style.display = 'block';
      businessDiv.style.display = 'none';
      setRequiredFields(personalDiv, true);
      setRequiredFields(businessDiv, false);
    } else if (businessRadio.checked) {
      personalDiv.style.display = 'none';
      businessDiv.style.display = 'block';
      setRequiredFields(personalDiv, false);
      setRequiredFields(businessDiv, true);
    }
  }

  function toggleDeliveryDivs() {
    if (deliveryRadio.checked) {
      onlyDeliveryDiv.style.display = 'block';
      setRequiredFields(onlyDeliveryDiv, true);
    } else if (pickupRadio.checked) {
      onlyDeliveryDiv.style.display = 'none';
      setRequiredFields(onlyDeliveryDiv, false);
    }
  }

  function setRequiredFields(div, isRequired) {
    const inputs = div.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
      if (isRequired) {
        input.setAttribute('required', 'required');
      } else {
        input.removeAttribute('required');
      }
    });
  }

  function updateDeliveryAddress() {
    if (sameDeliveryCheckbox.checked) {
      deliveryStreet.value = factuurStreet.value;
      deliveryPostcode.value = factuurPostcode.value;
      deliveryPlace.value = factuurPlace.value;
    }
  }

  function toggleDeliveryAddressDiv() {
    if (sameDeliveryCheckbox.checked) {
      deliveryAddressDiv.style.display = 'none';
      updateDeliveryAddress();
    } else {
      deliveryAddressDiv.style.display = 'block';
    }
  }

  personalRadio.addEventListener('change', toggleAccountDivs);
  businessRadio.addEventListener('change', toggleAccountDivs);
  deliveryRadio.addEventListener('change', toggleDeliveryDivs);
  pickupRadio.addEventListener('change', toggleDeliveryDivs);
  sameDeliveryCheckbox.addEventListener('change', toggleDeliveryAddressDiv);

  factuurStreet.addEventListener('input', updateDeliveryAddress);
  factuurPostcode.addEventListener('input', updateDeliveryAddress);
  factuurPlace.addEventListener('input', updateDeliveryAddress);

  toggleAccountDivs();
  toggleDeliveryAddressDiv();
  toggleDeliveryDivs()
});


function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(';').shift();
}

document.getElementById('checkoutForm').addEventListener('submit', async (event) => {
  event.preventDefault();
  document.getElementById('submitform').style.display = "none";
  document.getElementById('loading').style.display = "block";

  const formData = {
    type: document.querySelector('input[name="type"]:checked')?.value,
    deliveryPickup: document.querySelector('input[name="delivery"]:checked')?.value,
    firstname: document.getElementById('firstname')?.value || '',
    name: document.getElementById('name')?.value || '',
    email: document.getElementById('email')?.value || '',
    telephone: document.getElementById('telephone')?.value || '',
    companyname: document.getElementById('companyname')?.value || '',
    btwnr: document.getElementById('btwnr')?.value || '',
    streetnrfact: document.getElementById('streetnrfact')?.value || '',
    postcodefact: document.getElementById('postcodefact')?.value || '',
    placefact: document.getElementById('placefact')?.value || '',
    samedeliveryadress: document.getElementById('samedeliveryadress')?.checked || false,
    deliverystreetnr: document.getElementById('deliverystreetnr')?.value || '',
    deliverypostcode: document.getElementById('deliverypostcode')?.value || '',
    deliveryplace: document.getElementById('deliveryplace')?.value || ''
  };
  try {
  const token = getCookie('token');

    if (!token) {
      window.location.href = '/se-connecter.html';
      return;
    }
  const response = await fetch('https://europe-west1-test-9efbe.cloudfunctions.net/passOrder?lang=fr', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify(formData)
  });

  const result = await response.json();

  if (result.redirectUrl) {
    window.location.href = result.redirectUrl;
  } else {
    window.location.href = '/se-connecter.html';
  }
} catch (error) {
  console.error('Error submitting form:', error);
  alert('Failed to submit form');
} finally {
    document.getElementById('submitform').style.display = "block";
    document.getElementById('loading').style.display = "none";
  }
});


  </script>
</body>
</html>
