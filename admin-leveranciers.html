<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>admin</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="/css/normalize.css" rel="stylesheet" type="text/css">
  <link href="/css/webflow.css" rel="stylesheet" type="text/css">
  <link href="/css/verfifoods-4d83b7.webflow.css" rel="stylesheet" type="text/css">
  <script src="https://use.typekit.net/nnx8vsx.js" type="text/javascript"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="/images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="/images/webclip.png" rel="apple-touch-icon">
  <link rel="stylesheet" href="https://use.typekit.net/nnx8vsx.css">
</head>
<body class="body">
  <div class="popupholder" id="popupaddsupplier">
    <div class="popupcontainer vis">
        <div class="closebtn" id="closepopupaddsupplier">X</div>
          <div class="leftalignflexvert"><label for="naamleverancier" class="brownundertitle">Naam leverancier</label><input class="text-field w-input" maxlength="256" name="naamleverancier" data-name="naamleverancier" placeholder="" type="text" id="naamleverancier" required=""><label for="Aantal" class="brownundertitle">Logo</label>
          <input type="file" id="fileInput" style="
              width: 90%;
          ">
            <button id="supplieraddbtn" class="button intypeholder notabs w-button" onclick="uploadImage()">Leverancier toevoegen</button>
            <div class="loading" id="supplieraddloading" data-animation-type="lottie" data-src="/images/loading.json" data-loop="0" data-direction="1" data-autoplay="1" data-is-ix2-target="0" data-renderer="svg" data-default-duration="3.16" data-duration="0"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 300 150" width="300" height="150" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px); content-visibility: visible;"><defs><clipPath id="__lottie_element_2"><rect width="300" height="150" x="0" y="0"></rect></clipPath></defs><g clip-path="url(#__lottie_element_2)"><g transform="matrix(-0.00004245352829457261,-1,1,-0.00004245352829457261,97.00225067138672,128.00225830078125)" opacity="1" style="display: none;"><g opacity="1" transform="matrix(1,0,0,1,53,53)"><path stroke-linecap="round" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="10" stroke="rgb(193,134,50)" stroke-opacity="1" stroke-width="10" d="M0 0"></path></g></g><g transform="matrix(-0.011605668812990189,-0.9999326467514038,0.9999326467514038,-0.011605668812990189,97.61866760253906,128.6115264892578)" opacity="1" style="display: block;"><g opacity="1" transform="matrix(1,0,0,1,53,53)"><path stroke-linecap="round" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="10" stroke="rgb(193,134,50)" stroke-opacity="1" stroke-width="10" d=" M27.993000030517578,-0.6510000228881836 C27.99799919128418,-0.4350000023841858 28,-0.21799999475479126 28,0"></path></g></g></g></svg></div>
            <div id="progressText" style="margin-top: 5px; font-size: 14px; display: none;"></div>
          </div>
    </div>
  </div>
  <div class="_100-widthcenter">
    <div class="containcenter dashboard">
      <div class="holdertopdashboard">
        <a href="/index.html" class="w-inline-block"><img src="images/logo-Verfifoods.png" loading="lazy" width="120" alt=""></a>
        <div class="brownundertitle">Admin</div>
      </div>
      <div class="holderdashboardcontent">
        <div class="holderlinksdashboard">
          <div class="mapslink _10down">
            <div class="typefoodicon dash"><img src="/images/8726224_shopping_cart_icon.svg" loading="lazy" alt=""></div>
            <div class="brownundertitle blue">Bestellingen</div>
          </div>
          <div class="mapslink _10down">
            <div class="typefoodicon dash"><img src="/images/usericon.svg" loading="lazy" alt=""></div>
            <div class="brownundertitle blue">Klanten</div>
          </div>
          <div class="mapslink _10down">
            <div class="typefoodicon dash"><img src="/images/listicon.svg" loading="lazy" alt=""></div>
            <div class="brownundertitle blue">Producten</div>
          </div>
          <div class="mapslink _10down">
            <div class="typefoodicon dash"><img src="/images/breadicon.svg" loading="lazy" alt=""></div>
            <div class="brownundertitle bold-text">Leveranciers</div>
          </div>
        </div>
        <div class="holderappdashboard">
          <div class="holderapptop">
            <div class="mapslink _10down">
              <div class="typefoodicon dash"><img src="/images/breadicon.svg" loading="lazy" alt=""></div>
              <div class="brownundertitle bold-text">Leveranciers</div>
            </div><img src="images/filterIcon.svg" loading="lazy" alt="" class="menuicon">
          </div>
          <div class="holderappresults">
            <div class="holderthumbnailproduct dashboard newadd" id="addsupplierbtn">
              <div class="button intypeholder w-button">Nieuwe leverancier </div>
              <div class="plussign">+</div>
            </div>
            <div class="holderthumbnailproduct dashboard">
              <div class="shoppingcartbtn smaller"><img src="/images/editicon.svg" loading="lazy" alt=""></div><img src="/images/Diversi-Foods.png" loading="lazy" sizes="(max-width: 479px) 43vw, 198px" srcset="images/Diversi-Foods-p-500.png 500w, images/Diversi-Foods-p-800.png 800w, images/Diversi-Foods-p-1080.png 1080w, images/Diversi-Foods-p-1600.png 1600w, images/Diversi-Foods.png 1882w" alt="" class="thumbproductimage leveranciers">
              <div class="thumbproductoverlay">
                <div class="mediumbold-text">Diversi Foods</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=66d843f7aa41c71a1134cb81" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script>
    const popupAddSupplier = document.getElementById("popupaddsupplier");     
    document.getElementById("addsupplierbtn").addEventListener("click", function() {
          popupAddSupplier.style.opacity = 1;
          popupAddSupplier.style.visibility = "visible";
    });
    document.getElementById("closepopupaddsupplier").addEventListener("click", function() {
          popupAddSupplier.style.opacity = 0;
          popupAddSupplier.style.visibility = "hidden";
    });
    </script>
  <script type="module">
    // Import Firebase functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getStorage, ref, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-storage.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

    // Your Firebase configuration (replace with your own config)
    const firebaseConfig = {
        apiKey: "AIzaSyCIQlfqz-Hd-Oe0tNjnEfJdwHwMy3JuNr4",
        authDomain: "test-9efbe.firebaseapp.com",
        projectId: "test-9efbe",
        storageBucket: "test-9efbe.appspot.com",
        messagingSenderId: "218327249026",
        appId: "1:218327249026:web:0d48fa588ac45ef557049b",
        measurementId: "G-2ZTZCL27TE"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);
    const db = getFirestore(app);  // Initialize Firestore

    // Upload Image function, now attached to the window object to be accessible globally
    window.uploadImage = function uploadImage() {
        document.getElementById('addsupplierbtn').style.display ="none";
        document.getElementById('addsupplierloading').style.display ="block";
        const fileInput = document.getElementById('fileInput');
        const file = fileInput.files[0];

        if (!file) {
            alert("Please select an image to upload.");
            return;
        }

        const supplierName = document.getElementById('naamleverancier').value;

        if (!supplierName) {
            alert("Please enter the supplier name.");
            document.getElementById('addsupplierbtn').style.display ="block";
            document.getElementById('addsupplierloading').style.display ="none";
            return;
        }

        const progressText = document.getElementById('progressText');
        progressText.style.display = 'block';
        progressText.innerHTML = '0%';

        // Create a storage reference
        const storageRef = ref(storage, 'leveranciers/' + file.name);

        // Upload the file
        const uploadTask = uploadBytesResumable(storageRef, file);

        // Listen for state changes, errors, and completion
        uploadTask.on('state_changed',
            (snapshot) => {
                // Update progress bar
                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                progressText.innerHTML = 'Opladen: ' + Math.round(progress) + '%';
            },
            (error) => {
                console.error('Upload failed', error);
                alert('Upload failed: ' + error.message);
                document.getElementById('addsupplierbtn').style.display ="block";
                document.getElementById('addsupplierloading').style.display ="none";
            },
            () => {
                // Upload completed successfully, get the download URL
                getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {
                    console.log('File available at', downloadURL);

                    // Add entry to Firestore "Leveranciers" collection
                    addDoc(collection(db, "Leveranciers"), {
                        Naam: supplierName,
                        Logo: downloadURL
                    }).then(() => {
                        alert('Leverancier toegevoegd met succes! URL: ' + downloadURL);
                        progressText.innerHTML = 'Leverancier toegevoegd';
                        document.getElementById('addsupplierbtn').style.display ="block";
                        document.getElementById('addsupplierloading').style.display ="none";
                        document.getElementById('naamleverancier').value = '';
                        document.getElementById('fileInput').value = '';
                    }).catch((error) => {
                        console.error('Error adding document to Firestore: ', error);
                        alert('Error adding document: ' + error.message);
                        document.getElementById('addsupplierbtn').style.display ="block";
                        document.getElementById('addsupplierloading').style.display ="none";
                    });
                });
            }
        );
    };
</script>


</body>
</html>
