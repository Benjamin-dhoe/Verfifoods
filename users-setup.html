<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Verfifoods</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="/css/normalize.css" rel="stylesheet" type="text/css">
  <link href="/css/webflow.css" rel="stylesheet" type="text/css">
  <link href="/css/verfifoods-4d83b7.webflow.css" rel="stylesheet" type="text/css">
  <script src="https://use.typekit.net/nnx8vsx.js" type="text/javascript"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="/images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="/images/webclip.png" rel="apple-touch-icon">
  <link rel="stylesheet" href="https://use.typekit.net/nnx8vsx.css">
</head>
<body class="body">
  <div class="logosolo">
    <a href="#" class="w-inline-block" id="loginlink"><img src="/images/logo-Verfifoods.png" loading="lazy" width="135" alt=""></a>
  </div>
  <section class="sectionsingle">
    <div class="containcenter smallcenter">
        <h1 class="headingonwhite">Account setup</h1>
        <div class="small-text">email</div>
        <div class="spacer10px"></div>
        <div class="spacer10px"></div>
        <form id="accountSetupForm">
          <div class="radio-container">
            <label class="radio-label">
              <input type="radio" name="type" value="personal" class="radio-input" required>
              Persoonlijk account
            </label>
            <label class="radio-label">
              <input type="radio" name="type" value="business" class="radio-input" required>
              Bedrijfsaccount
            </label>
          </div>
          <div class="spacer10px"></div>
          <label class="brownundertitle">Telefoon nr</label>
          <input class="text-field w-input" maxlength="256" type="text" id="telephone" name="telephone" required>
          <div id="personaldiv" style="display: none;">
            <label class="brownundertitle">Voornaam</label>
            <input class="text-field w-input" maxlength="256" type="text" id="firstname" name="firstname" required>
            <label class="brownundertitle">Naam</label>
            <input class="text-field w-input" maxlength="256" type="text" id="name" name="name" required>
            <label class="brownundertitle bold-text">Standaard leveradres</label>
          </div>
          <div id="businessdiv" style="display: none;">
            <label class="brownundertitle">Bedrijfsnaam</label>
            <input class="text-field w-input" maxlength="256" type="text" id="companyname" name="companyname" required>
            <label class="brownundertitle">BTW nummer</label>
            <input class="text-field w-input" maxlength="256" type="text" id="btwnr" name="btwnr" required>
            <div class="spacer10px"></div>
            <label class="brownundertitle bold-text">Bedrijfsadres</label>
            <label class="brownundertitle">Straat en huisnummer</label>
            <input class="text-field w-input" maxlength="256" type="text" id="streetnrcompany" name="streetnrcompany" required>
            <label class="brownundertitle">Postcode</label>
            <input class="text-field w-input" maxlength="256" type="text" id="postcodecompany" name="postcodecompany" required>
            <label class="brownundertitle">Plaats</label>
            <input class="text-field w-input" maxlength="256" type="text" id="placecompany" name="placecompany" required>
            <div class="spacer10px"></div>
            <label class="brownundertitle bold-text">Standaard leveradres</label>
            <label>
              <input type="checkbox" id="samedeliveryadress" name="samedeliveryadress">
              <span></span>
              Zelfde als bedrijfsadres
            </label>
            <div class="spacer10px"></div>
            
          </div>
          <div id="deliveryadress">
              <label class="brownundertitle">Straat en huisnummer</label>
              <input class="text-field w-input" maxlength="256" type="text" id="deliverystreetnr" name="deliverystreetnr" required>
              <label class="brownundertitle">Postcode</label>
              <input class="text-field w-input" maxlength="256" type="text" id="deliverypostcode" name="deliverypostcode" required>
              <label class="brownundertitle">Plaats</label>
              <input class="text-field w-input" maxlength="256" type="text" id="deliveryplace" name="deliveryplace" required>
            </div>
          <div class="spacer10px"></div>
          <div class="loading" id="loading" style="display: none;">
              <lottie-player
                  src="/images/loading.json"
                  background="transparent"
                  speed="1"
                  loop
                  autoplay>
              </lottie-player>
          </div>
          <button type="submit" class="button intypeholder notabs w-button" id="submitform">Doorgaan</button>
        </form>
    </div>
  </section>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=66d843f7aa41c71a1134cb81" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script>
document.addEventListener('DOMContentLoaded', function () {
  const personalDiv = document.getElementById('personaldiv');
  const businessDiv = document.getElementById('businessdiv');
  const personalRadio = document.querySelector('input[value="personal"]');
  const businessRadio = document.querySelector('input[value="business"]');
  const sameDeliveryCheckbox = document.getElementById('samedeliveryadress');
  const deliveryAddressDiv = document.getElementById('deliveryadress');

  const companyStreet = document.getElementById('streetnrcompany');
  const companyPostcode = document.getElementById('postcodecompany');
  const companyPlace = document.getElementById('placecompany');

  const deliveryStreet = document.getElementById('deliverystreetnr');
  const deliveryPostcode = document.getElementById('deliverypostcode');
  const deliveryPlace = document.getElementById('deliveryplace');

  function toggleAccountDivs() {
    if (personalRadio.checked) {
      personalDiv.style.display = 'block';
      businessDiv.style.display = 'none';
      setRequiredFields(personalDiv, true);
      setRequiredFields(businessDiv, false);
    } else if (businessRadio.checked) {
      personalDiv.style.display = 'none';
      businessDiv.style.display = 'block';
      setRequiredFields(personalDiv, false);
      setRequiredFields(businessDiv, true);
    }
  }

  function setRequiredFields(div, isRequired) {
    const inputs = div.querySelectorAll('input, select, textarea');
    inputs.forEach(input => {
      if (isRequired) {
        input.setAttribute('required', 'required');
      } else {
        input.removeAttribute('required');
      }
    });
  }

  function updateDeliveryAddress() {
    if (sameDeliveryCheckbox.checked) {
      deliveryStreet.value = companyStreet.value;
      deliveryPostcode.value = companyPostcode.value;
      deliveryPlace.value = companyPlace.value;
    }
  }

  function toggleDeliveryAddressDiv() {
    if (sameDeliveryCheckbox.checked) {
      deliveryAddressDiv.style.display = 'none';
      updateDeliveryAddress();
    } else {
      deliveryAddressDiv.style.display = 'block';
    }
  }

  // Event listeners for form inputs
  personalRadio.addEventListener('change', toggleAccountDivs);
  businessRadio.addEventListener('change', toggleAccountDivs);
  sameDeliveryCheckbox.addEventListener('change', toggleDeliveryAddressDiv);

  // Update delivery address fields when business address fields change
  companyStreet.addEventListener('input', updateDeliveryAddress);
  companyPostcode.addEventListener('input', updateDeliveryAddress);
  companyPlace.addEventListener('input', updateDeliveryAddress);

  toggleAccountDivs();
  toggleDeliveryAddressDiv();
});

// Function to get token from cookies
function getCookie(name) {
  const value = `; ${document.cookie}`;
  const parts = value.split(`; ${name}=`);
  if (parts.length === 2) return parts.pop().split(';').shift();
}

document.getElementById('accountSetupForm').addEventListener('submit', async (event) => {
  event.preventDefault();  // Prevent the default form submission behavior
  document.getElementById('submitform').style.display = "none";
  document.getElementById('loading').style.display = "block";

  // Collect the form data
  const formData = {
    type: document.querySelector('input[name="type"]:checked')?.value,
    firstname: document.getElementById('firstname')?.value || '',
    name: document.getElementById('name')?.value || '',
    telephone: document.getElementById('telephone')?.value || '',
    companyname: document.getElementById('companyname')?.value || '',
    btwnr: document.getElementById('btwnr')?.value || '',
    streetnrcompany: document.getElementById('streetnrcompany')?.value || '',
    postcodecompany: document.getElementById('postcodecompany')?.value || '',
    placecompany: document.getElementById('placecompany')?.value || '',
    samedeliveryadress: document.getElementById('samedeliveryadress')?.checked || false,
    deliverystreetnr: document.getElementById('deliverystreetnr')?.value || '',
    deliverypostcode: document.getElementById('deliverypostcode')?.value || '',
    deliveryplace: document.getElementById('deliveryplace')?.value || ''
  };
  try {
  const token = getCookie('token'); // Assuming the token is stored in a cookie named 'token'

    if (!token) {
      window.location.href = '/nl/login.html';
      return;
    }
  const response = await fetch('https://europe-west1-test-9efbe.cloudfunctions.net/userSetup?lang=nl', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify(formData)
  });

  const result = await response.json();

  if (result.redirectUrl) {
    window.location.href = result.redirectUrl;
  } else {
    window.location.href = '/nl/login.html';
  }
} catch (error) {
  console.error('Error submitting form:', error);
  alert('Failed to submit form');
} finally {
    document.getElementById('submitform').style.display = "block";
    document.getElementById('loading').style.display = "none";
  }
});


  </script>
</body>
</html>
