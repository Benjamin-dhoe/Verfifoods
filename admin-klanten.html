<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>admin</title>
  <meta content="admin" property="og:title">
  <meta content="admin" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="/css/normalize.css" rel="stylesheet" type="text/css">
  <link href="/css/webflow.css" rel="stylesheet" type="text/css">
  <link href="/css/verfifoods-4d83b7.webflow.css" rel="stylesheet" type="text/css">
  <script src="https://use.typekit.net/nnx8vsx.js" type="text/javascript"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="/images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="/images/webclip.png" rel="apple-touch-icon">
  <link rel="stylesheet" href="https://use.typekit.net/nnx8vsx.css">
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>
<body class="body">
<div id="popupaddklant" class="popupholder">
    <div class="popupcontainer vis">
        <div class="closebtn" id="closepopupaddklant">X</div>
          <div class="leftalignflexvert overflow">
            <div id="accountSetupForm">
               <div class="radio-container">
                 <label class="radio-label">
                   <input type="radio" name="type" value="personal" class="radio-input" required>
                   B2C-klant
                 </label>
                 <label class="radio-label">
                   <input type="radio" name="type" value="business" class="radio-input" required>
                   B2B-klant
                 </label>
               </div>
               <div class="spacer10px"></div>
                <label class="brownundertitle">Email</label>
               <input class="text-field w-input" maxlength="256" type="text" id="email" name="email" required>
               <label class="brownundertitle">Telefoon</label>
               <input class="text-field w-input" maxlength="256" type="text" id="telephone" name="telephone" required>
               <div id="personaldiv" style="display: none;">
                 <label class="brownundertitle">Voornaam</label>
                 <input class="text-field w-input" maxlength="256" type="text" id="firstname" name="firstname" required>
                 <label class="brownundertitle">Naam</label>
                 <input class="text-field w-input" maxlength="256" type="text" id="name" name="name" required>
               </div>
               <div id="businessdiv" style="display: none;">
                 <label class="brownundertitle">Bedrijfsnaam</label>
                 <input class="text-field w-input" maxlength="256" type="text" id="companyname" name="companyname" required>
                 <label class="brownundertitle">BTW nummer</label>
                 <input class="text-field w-input" maxlength="256" type="text" id="btwnr" name="btwnr" required>
                 
               </div>
               <div>
                 <div class="spacer10px"></div>
                 <label class="brownundertitle bold-text">Factuuradres</label>
                 <label class="brownundertitle">Straat en huisnummer</label>
                 <input class="text-field w-input" maxlength="256" type="text" id="streetnrfact" name="streetnrfact" required>
                 <label class="brownundertitle">Postcode</label>
                 <input class="text-field w-input" maxlength="256" type="text" id="postcodefact" name="postcodefact" required>
                 <label class="brownundertitle">Plaats</label>
                 <input class="text-field w-input" maxlength="256" type="text" id="placefact" name="placefact" required>
                 <div class="spacer10px"></div>
                 <label class="brownundertitle bold-text">Leveringsadres</label>
                 <label>
                   <input type="checkbox" id="samedeliveryadress" name="samedeliveryadress">
                   <span></span>
                   Identiek aan factuuradres
                 </label>
                 <div class="spacer10px"></div>
               </div>  
               
               <div id="deliveryadress">
                   <label class="brownundertitle">Straat en huisnummer</label>
                   <input class="text-field w-input" maxlength="256" type="text" id="deliverystreetnr" name="deliverystreetnr" required>
                   <label class="brownundertitle">Postcode</label>
                   <input class="text-field w-input" maxlength="256" type="text" id="deliverypostcode" name="deliverypostcode" required>
                   <label class="brownundertitle">Plaats</label>
                   <input class="text-field w-input" maxlength="256" type="text" id="deliveryplace" name="deliveryplace" required>
                 </div>
               <div class="spacer10px"></div>
               <div class="loading" id="loadingaddklant" style="display: none;">
                   <lottie-player
                       src="/images/loading.json"
                       background="transparent"
                       speed="1"
                       loop
                       autoplay>
                   </lottie-player>
               </div>
               <button type="submit" class="button intypeholder notabs w-button" onClick="addKlant()">Klant toevoegen</button>
                <div id="progressText" style="margin-top: 5px; font-size: 14px; display: none;"></div>
          </div>
    </div>
  </div>
</div>
  
  <div class="_100-widthcenter">
    <div class="containcenter dashboard">
      <div class="holdertopdashboard">
        <a href="/index.html" class="w-inline-block"><img src="/images/logo-Verfifoods.png" loading="lazy" width="120" alt=""></a>
        <div class="brownundertitle">Admin</div>
      </div>
      <div class="holderdashboardcontent">
        <div class="holderlinksdashboard">
          <div class="menuicondash close" closesidemenu>
              <div class="bold-text">X</div>
          </div>
          <a href="/admin/bestellingen" class="mapslink _10down">
            <div class="typefoodicon dash"><img src="/images/ordericon.svg" loading="lazy" alt=""></div>
            <div class="brownundertitle blue">Bestellingen</div>
          </a>
          <a href="/admin/klanten" class="mapslink _10down">
            <div class="typefoodicon dash"><img src="/images/usericon.svg" loading="lazy" alt=""></div>
            <div class="brownundertitle bold-text">Klanten</div>
          </a>
          <a href="/admin/producten" class="mapslink _10down">
            <div class="typefoodicon dash"><img src="/images/producticon.svg" loading="lazy" alt=""></div>
            <div class="brownundertitle blue">Producten</div>
          </a>
          <a href="/admin/leveranciers" class="mapslink _10down">
            <div class="typefoodicon dash"><img src="/images/breadicon.svg" loading="lazy" alt=""></div>
            <div class="brownundertitle blue">Leveranciers</div>
          </a>
          <div class="spacer10px"></div>
          <div class="spacer10px"></div>
          <div class="spacer10px"></div>
          <a id="logoutBtn" class="mapslink _10down">
            <div class="typefoodicon dash"><img src="/images/logout.svg" loading="lazy" alt=""></div>
            <div class="brownundertitle blue">Uitloggen</div>
          </a>
        </div>
        <div class="holderappdashboard">
          <div class="holderapptop">
            <div class="mapslink _10down">
              <div class="typefoodicon dash"><img src="/images/usericon.svg" loading="lazy" alt=""></div>
              <div class="brownundertitle bold-text">Klanten</div>
            </div>
            <div class="menuicondash" opensidemenu>
              <img src="/images/listicon.svg" loading="lazy" alt="">
            </div>
          </div>
          <div class="holderappresults" id="mainresults">
            <div class="flexhorizontalwrap gap left">
              <button class="button intypeholder notabs w-button" id="addklant">Voeg klant toe</button>
              <button class="button intypeholder notabs grey w-button" onclick="exportTableToXLSX('tableXL')">Exporteer naar excel</button>
            </div>
            <div class="table-container" id="klantenTable">
                <table class="styled-table" id="tableXL">
                    <thead>
                        <tr>
                            <th>Klant</th>
                            <th>UserID</th>
                            <th>Admin/user</th>
                            <th>Type</th>
                            <th>Email</th>
                            <th>Telefoon</th>
                            <th>Setup</th>
                            <th>Fact</th>
                            <th>Lev</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be dynamically added here by the script -->
                    </tbody>
                </table>
              </div>
        </div>

        <div id="popupeditklant" class="holderappresults spacebetween" style="display: none;">
          <div class="closebtn" id="closepopupeditklant">X</div>
          <div class="leftalignflexvert" style="min-width: 40%;">
                <div class="bold-text brown-text" id="detailklantid"></div>
                <div class="spacer10px"></div>
                <div id="duidingklant"></div>
                <input type="hidden" id="updateid" value="">
                
                  <div id="accountEditForm">
                   <div class="radio-container">
                     <label class="radio-label">
                       <input type="radio" name="edittype" value="personal" class="radio-input" required>
                       B2C-klant
                     </label>
                     <label class="radio-label">
                       <input type="radio" name="edittype" value="business" class="radio-input" required>
                       B2B-klant
                     </label>
                   </div>
                   <div class="spacer10px"></div>
                   <label class="brownundertitle">Telefoon</label>
                   <input class="text-field w-input" maxlength="256" type="text" id="edittelephone" name="telephone" required>
                   <div id="editpersonaldiv" style="display: none;">
                     <label class="brownundertitle">Voornaam</label>
                     <input class="text-field w-input" maxlength="256" type="text" id="editfirstname" name="firstname" required>
                     <label class="brownundertitle">Naam</label>
                     <input class="text-field w-input" maxlength="256" type="text" id="editname" name="name" required>
                   </div>
                   <div id="editbusinessdiv" style="display: none;">
                     <label class="brownundertitle">Bedrijfsnaam</label>
                     <input class="text-field w-input" maxlength="256" type="text" id="editcompanyname" name="companyname" required>
                     <label class="brownundertitle">BTW nummer</label>
                     <input class="text-field w-input" maxlength="256" type="text" id="editbtwnr" name="btwnr" required>
                     
                   </div>
                   <div>
                     <div class="spacer10px"></div>
                     <label class="brownundertitle bold-text">Factuuradres</label>
                     <label class="brownundertitle">Straat en huisnummer</label>
                     <input class="text-field w-input" maxlength="256" type="text" id="editstreetnrfact" name="streetnrfact" required>
                     <label class="brownundertitle">Postcode</label>
                     <input class="text-field w-input" maxlength="256" type="text" id="editpostcodefact" name="postcodefact" required>
                     <label class="brownundertitle">Plaats</label>
                     <input class="text-field w-input" maxlength="256" type="text" id="editplacefact" name="placefact" required>
                     <div class="spacer10px"></div>
                     <label class="brownundertitle bold-text">Leveringsadres</label>
                     <div class="spacer10px"></div>
                   </div>  
                       <label class="brownundertitle">Straat en huisnummer</label>
                       <input class="text-field w-input" maxlength="256" type="text" id="editdeliverystreetnr" name="deliverystreetnr" required>
                       <label class="brownundertitle">Postcode</label>
                       <input class="text-field w-input" maxlength="256" type="text" id="editdeliverypostcode" name="deliverypostcode" required>
                       <label class="brownundertitle">Plaats</label>
                       <input class="text-field w-input" maxlength="256" type="text" id="editdeliveryplace" name="deliveryplace" required>
                   <div class="spacer10px"></div>
                     <div class="loading" id="loadingeditklant" style="display: none;">
                         <lottie-player
                             src="/images/loading.json"
                             background="transparent"
                             speed="1"
                             loop
                             autoplay>
                         </lottie-player>
                     </div>
                      <div id="succesvolleupdate" class="w-form-done">Klant succesvol geupdate!</div>
                     <button type="submit" class="button intypeholder notabs w-button" id="updateKlantBtn">Aanpassingen opslagen</button>
                </div>
            </div>

            <div id="klantorders" style="min-width: 40%; overflow: scroll">
                
            </div>
        </div>

          
      </div>
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=66d843f7aa41c71a1134cb81" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="/js/dash-aanbod.js" type="text/javascript"></script>
  <script type="module">
  // Import Firebase SDK and initialize the app
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, getDoc, updateDoc, doc, setDoc, query, where } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCIQlfqz-Hd-Oe0tNjnEfJdwHwMy3JuNr4",
    authDomain: "test-9efbe.firebaseapp.com",
    projectId: "test-9efbe",
    storageBucket: "test-9efbe.appspot.com",
    messagingSenderId: "218327249026",
    appId: "1:218327249026:web:0d48fa588ac45ef557049b",
    measurementId: "G-2ZTZCL27TE"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  function checkAuth() {
    onAuthStateChanged(auth, (user) => {
      if (user) {
        console.log("User is logged in:", user);
      } else {
        console.log("No user is logged in");
      }
    });
  }

  window.onload = function() {
    checkAuth();
    displayKlanten();
  };

  // Function to add klant to Firestore and Storage
  window.addKlant = async function addKlant() {
    const type = document.querySelector('input[name="type"]:checked')?.value;
    const email = document.getElementById('email')?.value.toLowerCase() || ''; // Ensure email is lowercase and used as the doc ID
    const firstname = document.getElementById('firstname')?.value || '';
    const name = document.getElementById('name')?.value || '';
    const telephone = document.getElementById('telephone')?.value || '';
    const companyname = document.getElementById('companyname')?.value || '';
    const btwnr = document.getElementById('btwnr')?.value || '';
    const streetnrfact = document.getElementById('streetnrfact')?.value || '';
    const postcodefact = document.getElementById('postcodefact')?.value || '';
    const placefact = document.getElementById('placefact')?.value || '';
    const samedeliveryadress = document.getElementById('samedeliveryadress')?.checked || false;
    const deliverystreetnr = document.getElementById('deliverystreetnr')?.value || '';
    const deliverypostcode = document.getElementById('deliverypostcode')?.value || '';
    const deliveryplace = document.getElementById('deliveryplace')?.value || '';

    const klantAddLoading = document.getElementById('loadingaddklant');
    progressText.style.display = 'block';
    klantAddLoading.style.display = 'block';
    progressText.innerHTML = '0%';

    try {
      // Add document to Firestore with email as the document ID
      await setDoc(doc(db, "Users", email), {
        type,
        firstname,
        name,
        telephone,
        companyname,
        btwnr,
        streetnrfact,
        postcodefact,
        placefact,
        samedeliveryadress,
        deliverystreetnr,
        deliverypostcode,
        deliveryplace,
        verwijderd: false
      });

      // After successful add, hide the loader and form
      klantAddLoading.style.display = 'none';
      document.getElementById('popupaddklant').style.opacity = 0;
      document.getElementById('popupaddklant').style.visibility = 'hidden';

      // Optionally, clear form fields
      document.getElementById('email').value = '';
      document.getElementById('firstname').value = '';
      document.getElementById('name').value = '';
      document.getElementById('telephone').value = '';
      document.getElementById('companyname').value = '';
      document.getElementById('btwnr').value = '';
      document.getElementById('streetnrfact').value = '';
      document.getElementById('postcodefact').value = '';
      document.getElementById('placefact').value = '';
      document.getElementById('samedeliveryadress').checked = false;
      document.getElementById('deliverystreetnr').value = '';
      document.getElementById('deliverypostcode').value = '';
      document.getElementById('deliveryplace').value = '';

      displayKlanten(); // Call function to refresh displayed users
    } catch (e) {
      console.error('Error adding klant: ', e);
      alert('Error bij toevoegen klant.');
    }
  };

  // Function to display klanten
  async function displayKlanten() {
    const klantenTable = document.getElementById('klantenTable'); // Table container
    const tableFragment = document.createDocumentFragment(); // Fragment for table rows

     try {
    const querySnapshot = await getDocs(collection(db, "Users"));
    querySnapshot.forEach((doc) => {
      const data = doc.data();
      console.log(data);

      if (!data.verwijderd) { // Only include users that are not marked as deleted
        const klantUid = data.uid || "";
        const klantSetup = data.setupdone || false;
        const klantType = data.type;
        const klantPhone = data.telephone;
        const klantEmail = doc.id;
        const klantBedrijf = data.companyname;
        const klantVoornaam = data.firstname;
        const klantNaam = data.name;
        const klantDateSetup = data.dateTimeSetup || "";
        let klantAanspreking;
        let klantTypeB2BC;
        let klantAdminUser;
        if (klantType === "business") {
          klantAanspreking = klantBedrijf;
          klantTypeB2BC = "B2B";
        } else if (klantType === "personal") {
          klantAanspreking = klantVoornaam + " " + klantNaam;
          klantTypeB2BC = "B2C";
        }

        if (klantSetup) {
          klantAdminUser = "user";
        } else {
          klantAdminUser = "admin";
        }

        // Create table row for the user
        const tableRow = document.createElement('tr');

        // Make the row clickable for editing the user
        tableRow.addEventListener('click', () => {
            populatePopup(data, klantEmail);
          
            const popupEditKlant = document.getElementById("popupeditklant");
            const mainResultsDiv = document.getElementById("mainresults");
            mainResultsDiv.style.display = "none";
            popupEditKlant.style.display = "flex";
          });

        // Create billing and delivery cells
        const billingCell = document.createElement('td');
        const deliveryCell = document.createElement('td');

        // Set up billing and delivery addresses
        const billingAddress = `${data.streetnrfact}, ${data.postcodefact} ${data.placefact}`;
        const deliveryAddress = data.samedeliveryadress ? billingAddress : `${data.deliverystreetnr}, ${data.deliverypostcode} ${data.deliveryplace}`;

        // Create tooltips
        const billingTooltip = document.createElement('span');
        billingTooltip.className = 'tooltip';
        billingTooltip.innerText = billingAddress;
        billingCell.appendChild(billingTooltip);
        billingCell.innerHTML += `<img class="deleteicon" src="/images/billing-address.png" loading="lazy">`;

        const deliveryTooltip = document.createElement('span');
        deliveryTooltip.className = 'tooltip';
        deliveryTooltip.innerText = deliveryAddress;
        deliveryCell.appendChild(deliveryTooltip);
        deliveryCell.innerHTML += `<img class="deleteicon" src="/images/delivery-address.png" loading="lazy">`;

        // Add mouseover and mouseout events for the tooltips
        billingCell.onmouseover = () => { billingTooltip.style.display = 'block'; };
        billingCell.onmouseout = () => { billingTooltip.style.display = 'none'; };

        deliveryCell.onmouseover = () => { deliveryTooltip.style.display = 'block'; };
        deliveryCell.onmouseout = () => { deliveryTooltip.style.display = 'none'; };

        // Add table row content (except for delete button)
        tableRow.innerHTML = `
          <td>${klantAanspreking}</td>
          <td>${klantUid}</td>
          <td>${klantAdminUser}</td>
          <td>${klantTypeB2BC}</td>
          <td>${klantEmail}</td>
          <td>${klantPhone}</td>
          <td>${klantDateSetup}</td>
        `;

        // Append the cells to the row
        tableRow.appendChild(billingCell);
        tableRow.appendChild(deliveryCell);

        // Append the row to the table fragment
        tableFragment.appendChild(tableRow);
      }
    });

  } catch (error) {
    console.error('Error fetching documents: ', error);
  }

  // Update the table
  const tableBody = klantenTable.querySelector('tbody');
  tableBody.innerHTML = ''; // Clear existing table rows
  tableBody.appendChild(tableFragment); // Add new rows to the table
}

    function deleteCookie(name) {
    document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
}

document.addEventListener('DOMContentLoaded', () => {
            const logoutBtn = document.getElementById('logoutBtn');
            logoutBtn.addEventListener('click', () => {
                signOut(auth).then(() => {
                    console.log('User signed out.');
                    deleteCookie('token');
                    deleteCookie('userId');
                    // Redirect to login page
                    window.location.href = '/index';
                }).catch((error) => {
                    console.error('Error signing out:', error);
                });
            });
        });

// klant aanpassen
async function populatePopup(data, klantEmail) {
    // Set the radio buttons based on bestelling type
    const klantType = data.type;
    const personalEditRadio = document.querySelector('input[name="edittype"][value="personal"]');
    const businessEditRadio = document.querySelector('input[name="edittype"][value="business"]');
    personalEditRadio.checked = (klantType === 'personal');
    businessEditRadio.checked = (klantType === 'business');
    
    toggleBusinessPersonalFields(klantType);
  
    // Populate fields with order data
    document.getElementById('detailklantid').textContent = `Klant: ${klantEmail}`;
    document.getElementById('updateid').value = klantEmail;
    document.getElementById('edittelephone').value = data.telephone || '';
    document.getElementById('editfirstname').value = data.firstname || '';
    document.getElementById('editname').value = data.name || '';
    document.getElementById('editcompanyname').value = data.companyname || '';
    document.getElementById('editbtwnr').value = data.btwnr || '';
    document.getElementById('editstreetnrfact').value = data.streetnrfact || '';
    document.getElementById('editpostcodefact').value = data.postcodefact || '';
    document.getElementById('editplacefact').value = data.placefact || '';

    // Populate delivery address
    document.getElementById('editdeliverystreetnr').value = data.deliverystreetnr || '';
    document.getElementById('editdeliverypostcode').value = data.deliverypostcode || '';
    document.getElementById('editdeliveryplace').value = data.deliveryplace || '';

    // Populate order details table
    const klantOrdersDiv = document.getElementById('klantorders');
    klantOrdersDiv.innerHTML = '<div class="spacer10px"></div><div>Bestellingen van deze klant</div><div class="spacer10px"></div>';

    // Create table structure
    const table = document.createElement('table');
    table.classList.add('styled-table');
    table.innerHTML = `
        <thead>
            <tr>
                <th>Levering/afhaling</td>
                <th>Type</td>
                <th>Status</td>
                <th>Prijs</td>
                <th>Dozen</td>
                <th>Bestelling ID</td>
            </tr>
        </thead>
        <tbody></tbody>
    `;
    const tbody = table.querySelector('tbody');

    const q = query(collection(db, 'Bestellingen'), where("email", "==", klantEmail));
    const userordersSnapshot = await getDocs(q);
    
    // Check if there are any orders
    if (userordersSnapshot.empty) {
        // Create a row with a message if no orders found
        const row = document.createElement('tr');
        row.innerHTML = `
            <td colspan="6" style="text-align: center;">Deze klant heeft geen bestellingen.</td>
        `;
        tbody.appendChild(row);
    } else {
        // Populate table rows with order data if orders are found
        userordersSnapshot.docs.forEach(doc => {
            const bestelling = doc.data();
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${bestelling.deliveryPickup || ''}</td>
                <td>${bestelling.type || ''}</td>
                <td>${bestelling.status || ''}</td>
                <td>${bestelling.totalPrice || ''}</td>
                <td>${bestelling.totalBoxes || ''}</td>
                <td>${doc.id}</td>
            `;
            tbody.appendChild(row);
        });
    }

// Append the table to the klantOrdersDiv
klantOrdersDiv.appendChild(table);
}

    function toggleBusinessPersonalFields(type) {
    const personalEditDiv = document.getElementById('editpersonaldiv');
    const businessEditDiv = document.getElementById('editbusinessdiv');
    if (type === 'personal') {
      personalEditDiv.style.display = 'block';
      businessEditDiv.style.display = 'none';
    } else if (type === 'business') {
      personalEditDiv.style.display = 'none';
      businessEditDiv.style.display = 'block';
    }
  }

    async function updateKlant(klantId) {
    document.getElementById('updateKlantBtn').style.display = "none";
    document.getElementById('loadingeditklant').style.display = "block";
    const klantType = document.querySelector('input[name="edittype"]:checked').value;

    // Gather updated data from the form
    const updatedData = {
      type: klantType,
      telephone: document.getElementById('edittelephone').value,
      firstname: document.getElementById('editfirstname').value,
      name: document.getElementById('editname').value,
      companyname: document.getElementById('editcompanyname').value,
      btwnr: document.getElementById('editbtwnr').value,
      streetnrfact: document.getElementById('editstreetnrfact').value,
      postcodefact: document.getElementById('editpostcodefact').value,
      placefact: document.getElementById('editplacefact').value,
      deliverystreetnr: document.getElementById('editdeliverystreetnr').value,
      deliverypostcode: document.getElementById('editdeliverypostcode').value,
      deliveryplace: document.getElementById('editdeliveryplace').value,
    };

    try {
      const docRef = doc(db, "Users", klantId);
      await updateDoc(docRef, updatedData);
      const succesvolleupdate = document.getElementById("succesvolleupdate");
      document.getElementById('loadingeditklant').style.display = "none";
      succesvolleupdate.style.display = "block";
      displayKlanten();
      setTimeout(() => {
        succesvolleupdate.style.display = "none";
        document.getElementById('updateKlantBtn').style.display = "block";
      }, 5000);
    } catch (error) {
      console.error('Error updating klant: ', error);
      document.getElementById('updateKlantBtn').style.display = "block";
    }
  }

  // Add event listener for the update button in the popup
  document.getElementById('updateKlantBtn').addEventListener('click', () => {
    const klantId = document.getElementById('updateid').value; // Replace with actual way to get ID
    updateKlant(klantId);
  });

  
</script>

<script>

  document.getElementById('addklant').addEventListener("click", function() {
    const popupAddKlant = document.getElementById("popupaddklant");
    popupAddKlant.style.opacity = 1;
    popupAddKlant.style.visibility = "visible";
  });

  

  document.getElementById("closepopupaddklant").addEventListener("click", function() {
    const popupAddKlant = document.getElementById("popupaddklant");
    popupAddKlant.style.opacity = 0;
    popupAddKlant.style.visibility = "hidden";
  });

    document.getElementById("closepopupeditklant").addEventListener("click", function() {
    const popupEditKlant = document.getElementById("popupeditklant");
    popupEditKlant.style.display = "none";
    const mainResultsDiv = document.getElementById("mainresults");
    mainResultsDiv.style.display = "flex";
  });



</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
 const personalDiv = document.getElementById('personaldiv');
 const businessDiv = document.getElementById('businessdiv');
 const personalRadio = document.querySelector('input[type="radio"][name="type"][value="personal"]');
 const businessRadio = document.querySelector('input[type="radio"][name="type"][value="business"]');
 const sameDeliveryCheckbox = document.getElementById('samedeliveryadress');
 const deliveryAddressDiv = document.getElementById('deliveryadress');

 const factStreet = document.getElementById('streetnrfact');
 const factPostcode = document.getElementById('postcodefact');
 const factPlace = document.getElementById('placefact');

 const deliveryStreet = document.getElementById('deliverystreetnr');
 const deliveryPostcode = document.getElementById('deliverypostcode');
 const deliveryPlace = document.getElementById('deliveryplace');

 function toggleAccountDivs() {
   if (personalRadio.checked) {
     personalDiv.style.display = 'block';
     businessDiv.style.display = 'none';
     setRequiredFields(personalDiv, true);
     setRequiredFields(businessDiv, false);
   } else if (businessRadio.checked) {
     personalDiv.style.display = 'none';
     businessDiv.style.display = 'block';
     setRequiredFields(personalDiv, false);
     setRequiredFields(businessDiv, true);
   }
 }

 function setRequiredFields(div, isRequired) {
   const inputs = div.querySelectorAll('input, select, textarea');
   inputs.forEach(input => {
     if (isRequired) {
       input.setAttribute('required', 'required');
     } else {
       input.removeAttribute('required');
     }
   });
 }

 function updateDeliveryAddress() {
   if (sameDeliveryCheckbox.checked) {
     deliveryStreet.value = factStreet.value;
     deliveryPostcode.value = factPostcode.value;
     deliveryPlace.value = factPlace.value;
   }
 }

 function toggleDeliveryAddressDiv() {
   if (sameDeliveryCheckbox.checked) {
     deliveryAddressDiv.style.display = 'none';
     updateDeliveryAddress();
   } else {
     deliveryAddressDiv.style.display = 'block';
   }
 }

 personalRadio.addEventListener('change', toggleAccountDivs);
 businessRadio.addEventListener('change', toggleAccountDivs);
 sameDeliveryCheckbox.addEventListener('change', toggleDeliveryAddressDiv);

 factStreet.addEventListener('input', updateDeliveryAddress);
 factPostcode.addEventListener('input', updateDeliveryAddress);
 factPlace.addEventListener('input', updateDeliveryAddress);

 toggleAccountDivs();
 toggleDeliveryAddressDiv();
});

  document.addEventListener('DOMContentLoaded', function () {
 const personalEditDiv = document.getElementById('editpersonaldiv');
 const businessEditDiv = document.getElementById('editbusinessdiv');
 const personalEditRadio = document.querySelector('input[type="radio"][name="edittype"][value="personal"]');
 const businessEditRadio = document.querySelector('input[type="radio"][name="edittype"][value="business"]');

 function toggleEditAccountDivs() {
   if (personalEditRadio.checked) {
     personalEditDiv.style.display = 'block';
     businessEditDiv.style.display = 'none';
     setEditRequiredFields(personalEditDiv, true);
     setEditRequiredFields(businessEditDiv, false);
   } else if (businessEditRadio.checked) {
     personalEditDiv.style.display = 'none';
     businessEditDiv.style.display = 'block';
     setEditRequiredFields(personalEditDiv, false);
     setEditRequiredFields(businessEditDiv, true);
   }
 }

 function setEditRequiredFields(div, isRequired) {
   const inputs = div.querySelectorAll('input, select, textarea');
   inputs.forEach(input => {
     if (isRequired) {
       input.setAttribute('required', 'required');
     } else {
       input.removeAttribute('required');
     }
   });
 }

 personalEditRadio.addEventListener('change', toggleEditAccountDivs);
 businessEditRadio.addEventListener('change', toggleEditAccountDivs);

 toggleEditAccountDivs();
});

function exportTableToXLSX(tableId) {
    const table = document.getElementById(tableId);
    const workbook = XLSX.utils.table_to_book(table, { sheet: "Sheet1" });
    XLSX.writeFile(workbook, "backup.xlsx");
}
</script>

</html>
